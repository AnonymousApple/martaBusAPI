<h2>You Are Currently Standing At...</h2>
<p>
  <%= @location.my_location %>
</p>

<h2>The Closest Buses Are...</h2>

<% if @bus_count == 0 %>
  <p>
    ...not really that close. Just order an Uber. Or Lyft.
    Or call a friend. Or just give up and go back inside to
    watch TV. Going places is overrated.
    </p>
<% end %>

<% @nearby_buses.each_with_index do |bus, index| %>
<script>
var userCoords = new google.maps.LatLng(<%= @location.latitude %>,         <%= @location.longitude %>);
var mapOptions = {
  center: userCoords,
  zoom: 13,
  scrollwheel: false
};

var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
</script>
  <p>
    <strong>Route:</strong> <%= bus["ROUTE"] %><br />
    <strong>Vehicle:</strong> <%= bus["VEHICLE"] %><br />
    <strong>Next Stop:</strong> <%= bus["TIMEPOINT"] %>
  </p>


<!-- Our Maps with Javascript-->
<script>

$(document).ready(function (){
    function initialize(){
     var busCoords = new google.maps.LatLng(<%= bus["LATITUDE"] %>, <%= bus["LONGITUDE"] %>);

      // This is the text for our bus
      var contentStringBus = "This is a bus!";

      // This is the text for our user
      var contentStringUser = "You are here";


      // This is the marker that shows where the bus is
      var img = {url: "<%= asset_path 'warning.png' %>",
                 scaledSize: new google.maps.Size(35, 35)};
      var busMarker = new google.maps.Marker({
        position: busCoords,
        map: map,
	animation: google.maps.Animation.BOUNCE,
  icon: img
      });

      // This is the marker for our users position
      var image = {url: "<%= asset_path 'X.png'%>",
                   scaledSize: new google.maps.Size(30, 30)};
      var userMarker = new google.maps.Marker({
        position: userCoords,
    	  map: map,
	      animation: google.maps.Animation.DROP,
        icon: image
      });

     // Info window and event listener for the bus
      var infoWindowBus = new google.maps.InfoWindow({
        content: contentStringBus
      });

      google.maps.event.addListener(busMarker, 'click', function() {
        infoWindowBus.open(map, busMarker);
      });

       // Info window and event listener for the user
      var infoWindowUser = new google.maps.InfoWindow({
        content: contentStringUser
      });

      google.maps.event.addListener(userMarker, 'click', function() {
        infoWindowUser.open(map, userMarker);
      });

    }

  google.maps.event.addDomListener(window, 'load', initialize);
  });

</script>

<!-- End maps -->

<% end %>
<div class="bus-map" id="map-canvas"></div>
<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDIwApHuvmhJw4bp8YkXMJEd8ntJVl8ek4">
 </script>
<%= link_to "Actually, I'm at...", edit_location_path(@location) %>

<%= link_to 'Back', locations_path %>
